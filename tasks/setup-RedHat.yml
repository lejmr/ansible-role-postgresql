---
- name: Ensure PostgreSQL packages are installed.
  yum:
    name: "{{ postgresql_packages }}"
    state: present
    enablerepo: "{{ postgresql_enablerepo | default(omit, true) }}"
    # Don't let postgresql-contrib cause the /usr/bin/python symlink
    # to be installed, which breaks later Ansible runs on Fedora 30,
    # and affects system behavior in multiple ways.
    exclude: python-unversioned-command

- name: Ensure PostgreSQL Python libraries are installed.
  yum:
    name: "{{ postgresql_python_library }}"
    state: present
    enablerepo: "{{ postgresql_enablerepo | default(omit, true) }}"

- name: Ensure template systemd unit file is installed.
  template:
    src: postgresql-template.service
    dest: /etc/systemd/system/postgresql@.service
  when: ansible_distribution_major_version|int >= 7

- name: Ensure init.d file is installed
  file:
    src: postgresql
    path: "/etc/init.d/{{ postgresql_daemon }}"
    state: link
  when: ansible_distribution_major_version|int < 7

- name: Ensure sysconfig is installed.
  template:
    src: sysconfig.j2
    dest: "{{ __postgresql_sysconfig_path }}/{{ postgresql_daemon }}"
  when: ansible_distribution_major_version|int < 7
